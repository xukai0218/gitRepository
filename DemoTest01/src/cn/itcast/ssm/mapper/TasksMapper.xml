<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.itcast.ssm.mapper.TasksMapper" >
 	<select id="selectAllTasks" resultType="cn.itcast.ssm.po.Tasks"  >
		select * from tasks 
  </select>
  
  	<select id="selectAllTasksResultMap" resultMap="selectAllTasksResultMap"  >
			SELECT
				t.*, 
				a.id assid,
				a.resourceId,
				a.roleId,
				a.effort
			FROM
				tasks t,
				assignment a
			WHERE
				t.assigs = a.id
  </select>
  
  <select id="getAssigsId" parameterType="cn.itcast.ssm.po.Tasks" resultType="String">
  		SELECT
			t.assigs
		FROM
			tasks t
		WHERE
			t.id = #{id}
  </select>
  
 <update id="updateTasks" parameterType="cn.itcast.ssm.po.TasksVo">
 	UPDATE tasks
		SET 
			name = #{tasks.name},
			progress = #{tasks.progress},
			progressByWorklog = #{tasks.progressByWorklog},
			relevance =#{tasks.relevance},
			type =#{tasks.type},
			typeId =#{tasks.typeId},
			description =#{tasks.description},
			code =#{tasks.code},
			status =#{tasks.status},
			level=#{tasks.level},
			canWrite =#{tasks.canWrite},
			start =#{tasks.start},
			duration =#{tasks.duration},
			end =#{tasks.end},
			endIsMilestone =#{tasks.endIsMilestone},
			startIsMilestone =#{tasks.startIsMilestone},
			collapsed =#{tasks.collapsed},
			hasChild =#{tasks.hasChild},
			assigs=#{assigsIds}
		WHERE
			id = #{tasks.id}
 </update>
  
  <insert id="insertTasks" parameterType="cn.itcast.ssm.po.TasksVo">
  		insert into  tasks (
			name,
			progress,
			progressByWorklog,
			relevance,
			type,
			typeId,
			description,
			code,
			status,
			level,
			canWrite,
			start,
			duration,
			end,
			endIsMilestone,
			startIsMilestone,
			collapsed,
			hasChild,
			assigs)
					 values (
					#{tasks.name},
					#{tasks.progress},
					#{tasks.progressByWorklog},
					#{tasks.relevance},
					#{tasks.type},
					#{tasks.typeId},
					#{tasks.description},
					#{tasks.code},
					#{tasks.status},
					#{tasks.level},
					#{tasks.canWrite},
					#{tasks.start},
					#{tasks.duration},
					#{tasks.end},
					#{tasks.endIsMilestone},
					#{tasks.startIsMilestone},
					#{tasks.collapsed},
					#{tasks.hasChild},
					#{assigsIds}
					)
  </insert>

   	<select id="selectTasksResultMap" parameterType="cn.itcast.ssm.po.TasksVo" resultMap="selectAllTasksResultMap"  >
   	
			SELECT
				t.*, 
				a.id assid,
				a.resourceId,
				a.roleId,
				a.effort
			FROM
				tasks t,
				assignment a
	<!-- 		where	
					t.id = 1
				AND a.id IN (   1, 2) -->
			 <where>
					<include refid="tasks"></include>
			</where> 
					
  </select>
  
  <sql id="tasks">
		<if test="tasks!=null">
			<if test="tasks.id!=null and tasks.id!=''">
				and t.id = #{tasks.id}
			</if>
		
			<!-- 实现  “ and id IN(1,10,16)”拼接 -->
			<foreach collection="assigsIdList" item="assigs_id" open="and a.id IN(" close=")" separator=",">
				 #{assigs_id}
			</foreach> 
			
		</if>
	</sql>

  
  
  
<resultMap type="cn.itcast.ssm.po.Tasks" id="selectAllTasksResultMap">
		<id column="id" property="id"/>
		<result column="name" property="name"/>
		<result column="progress" property="progress"/>
		<result column="progressByWorklog" property="progressByWorklog"/>
		<result column="relevance" property="relevance"/>
		<result column="type" property="type"/>
		<result column="typeId" property="typeId"/>
		<result column="description" property="description"/>
		<result column="code" property="code"/>
		<result column="level" property="level"/>
		<result column="status" property="status"/>
		<result column="depends" property="depends"/>
		<result column="canWrite" property="canWrite"/>
		<result column="start" property="start"/>
		<result column="duration" property="duration"/>
		<result column="end" property="end"/>
		<result column="startIsMilestone" property="startIsMilestone"/>
		<result column="endIsMilestone" property="endIsMilestone"/>
		<result column="startIsMilestone" property="startIsMilestone"/>
		<result column="collapsed" property="collapsed"/>
		<result column="hasChild" property="hasChild"/>
		
		<collection property="assigs" ofType="cn.itcast.ssm.po.Assignment">
			<id column="assid" property="id"/>
			<result column="resourceId" property="resourceId"/>
			<result column="roleId" property="roleId"/>
			<result column="effort" property="effort"/>
		</collection>
</resultMap>  


</mapper>